/** Jindo Component(minify:5) : ../../../docs/jindo-component/archive/1.9.0/
 *	jindo.Component
 *	jindo.UIComponent
 *	jindo.DragArea
 *	jindo.DropArea
 */
jindo.Component=jindo.$Class({_htEventHandler:null,_htOption:null,$init:function(){var e=this.constructor.getInstance();e.push(this),this._htEventHandler={},this._htOption={},this._htOption._htSetter={}},option:function(e,t){switch(typeof e){case"undefined":var n={};for(var i in this._htOption)"htCustomEventHandler"!=i&&"_htSetter"!=i&&(n[i]=this._htOption[i]);return n;case"string":if("undefined"==typeof t)return this._htOption[e];if("htCustomEventHandler"==e){if("undefined"!=typeof this._htOption[e])return this;this.attach(t)}this._htOption[e]=t,"function"==typeof this._htOption._htSetter[e]&&this._htOption._htSetter[e](t);break;case"object":for(var a in e){if("htCustomEventHandler"==a){if("undefined"!=typeof this._htOption[a])continue;this.attach(e[a])}"_htSetter"!==a&&(this._htOption[a]=e[a]),"function"==typeof this._htOption._htSetter[a]&&this._htOption._htSetter[a](e[a])}}return this},optionSetter:function(e,t){switch(typeof e){case"undefined":return this._htOption._htSetter;case"string":if("undefined"==typeof t)return this._htOption._htSetter[e];this._htOption._htSetter[e]=jindo.$Fn(t,this).bind();break;case"object":for(var n in e)this._htOption._htSetter[n]=jindo.$Fn(e[n],this).bind()}return this},fireEvent:function(e,t){t=t||{};var n=this["on"+e],i=this._htEventHandler[e]||[],a="function"==typeof n,o=i.length>0;if(!a&&!o)return!0;i=i.concat(),t.sType=e,"undefined"==typeof t._aExtend&&(t._aExtend=[],t.stop=function(){t._aExtend.length>0&&(t._aExtend[t._aExtend.length-1].bCanceled=!0)}),t._aExtend.push({sType:e,bCanceled:!1});var r,s,h=[t];for(r=2,s=arguments.length;s>r;r++)h.push(arguments[r]);if(a&&n.apply(this,h),o){var l;for(r=0,l;l=i[r];r++)l.apply(this,h)}return!t._aExtend.pop().bCanceled},attach:function(e,t){if(1==arguments.length)return jindo.$H(arguments[0]).forEach(jindo.$Fn(function(e,t){this.attach(t,e)},this).bind()),this;var n=this._htEventHandler[e];return"undefined"==typeof n&&(n=this._htEventHandler[e]=[]),n.push(t),this},detach:function(e,t){if(1==arguments.length)return jindo.$H(arguments[0]).forEach(jindo.$Fn(function(e,t){this.detach(t,e)},this).bind()),this;var n=this._htEventHandler[e];if(n)for(var i,a=0;i=n[a];a++)if(i===t){n=n.splice(a,1);break}return this},detachAll:function(e){var t=this._htEventHandler;if(arguments.length)return"undefined"==typeof t[e]?this:(delete t[e],this);for(var n in t)delete t[n];return this}}),jindo.Component.factory=function(e,t){var n,i=[];"undefined"==typeof t&&(t={});for(var a,o=0;a=e[o];o++)n=new this(a,t),i[i.length]=n;return i},jindo.Component.getInstance=function(){return"undefined"==typeof this._aInstance&&(this._aInstance=[]),this._aInstance},jindo.Component.VERSION="1.9.0",jindo.UIComponent=jindo.$Class({$init:function(){this._bIsActivating=!1},isActivating:function(){return this._bIsActivating},activate:function(){return this.isActivating()?this:(this._bIsActivating=!0,arguments.length>0?this._onActivate.apply(this,arguments):this._onActivate(),this)},deactivate:function(){return this.isActivating()?(this._bIsActivating=!1,arguments.length>0?this._onDeactivate.apply(this,arguments):this._onDeactivate(),this):this}}).extend(jindo.Component),jindo.DragArea=jindo.$Class({$init:function(e,t){this.option({sClassName:"draggable",bFlowOut:!0,bSetCapture:!0,nThreshold:0}),this.option(t||{}),this._wel=e,this._bIE=jindo.$Agent().navigator().ie,this._htDragInfo={bIsDragging:!1,bPrepared:!1,bHandleDown:!1,bForceDrag:!1},this._wfOnMouseDown=jindo.$Fn(this._onMouseDown,this),this._wfOnMouseMove=jindo.$Fn(this._onMouseMove,this),this._wfOnMouseUp=jindo.$Fn(this._onMouseUp,this),this._wfOnDragStart=jindo.$Fn(this._onDragStart,this),this._wfOnSelectStart=jindo.$Fn(this._onSelectStart,this),this.activate()},_findDraggableElement:function(e){if(1===e.nodeType&&jindo.$$.test(e,"input[type=text], textarea, select"))return null;var t=this,n="."+this.option("sClassName"),i=function(e){return null===e?!1:t._wel===document||t._wel===e?!0:jindo.$Element(t._wel).isParentOf(e)},a=jindo.$$.test(e,n)?e:jindo.$$.getSingle("! "+n,e);return i(a)||(a=null),a},isDragging:function(){var e=this._htDragInfo;return e.bIsDragging&&!e.bPrepared},stopDragging:function(){return this._stopDragging(!0),this},_stopDragging:function(e){if(this._wfOnMouseMove.detach(document,"mousemove"),this._wfOnMouseUp.detach(document,"mouseup"),this.isDragging()){var t=this._htDragInfo,n=jindo.$Element(t.elDrag);t.bIsDragging=!1,t.bForceDrag=!1,t.bPrepared=!1,this._bIE&&this._elSetCapture&&(this._elSetCapture.releaseCapture(),this._elSetCapture=null),this.fireEvent("dragEnd",{elArea:this._wel,elHandle:t.elHandle,elDrag:t.elDrag,nX:parseInt(n.css("left"),10)||0,nY:parseInt(n.css("top"),10)||0,bInterupted:e})}},_onActivate:function(){this._wfOnMouseDown.attach(this._wel,"mousedown"),this._wfOnDragStart.attach(this._wel,"dragstart"),this._wfOnSelectStart.attach(this._wel,"selectstart")},_onDeactivate:function(){this._wfOnMouseDown.detach(this._wel,"mousedown"),this._wfOnDragStart.detach(this._wel,"dragstart"),this._wfOnSelectStart.detach(this._wel,"selectstart")},attachEvent:function(){this.activate()},detachEvent:function(){this.deactivate()},isEventAttached:function(){return this.isActivating()},startDragging:function(e){var t=this._findDraggableElement(e);return t?(this._htDragInfo.bForceDrag=!0,this._htDragInfo.bPrepared=!0,this._htDragInfo.elHandle=t,this._htDragInfo.elDrag=t,this._wfOnMouseMove.attach(document,"mousemove"),this._wfOnMouseUp.attach(document,"mouseup"),!0):!1},_onMouseDown:function(e){var t=e.mouse(!0);if(/^mouse/.test(e.type)&&(!t.left||t.right||t.scrollbar))return this._stopDragging(!0),void 0;var n=this._findDraggableElement(e.element);if(n){var i=e.pos(),a=this._htDragInfo;a.bHandleDown=!0,a.bPrepared=!0,a.nButton=e._event.button,a.elHandle=n,a.elDrag=n,a.nPageX=i.pageX,a.nPageY=i.pageY,this.fireEvent("handleDown",{elHandle:n,elDrag:n,weEvent:e})&&this._wfOnMouseMove.attach(document,"mousemove"),this._wfOnMouseUp.attach(document,"mouseup"),e.stop(jindo.$Event.CANCEL_DEFAULT)}},_onMouseMove:function(e){var t,n,i=this._htDragInfo,a=e.pos(),o={nX:a.pageX-i.nPageX,nY:a.pageY-i.nPageY};if(i.bPrepared){var r=this.option("nThreshold"),s={};if(!i.bForceDrag&&r){s.nPageX=a.pageX-i.nPageX,s.nPageY=a.pageY-i.nPageY;var h=Math.sqrt(s.nPageX*s.nPageX+s.nPageY*s.nPageY);if(r>h)return}if(this._bIE&&this.option("bSetCapture")&&(this._elSetCapture=this._wel===document?document.body:this._findDraggableElement(e.element),this._elSetCapture&&this._elSetCapture.setCapture(!1)),t={elArea:this._wel,elHandle:i.elHandle,elDrag:i.elDrag,htDiff:s,weEvent:e},i.bIsDragging=!0,i.bPrepared=!1,!this.fireEvent("dragStart",t))return i.bPrepared=!0,void 0;var l=jindo.$Element(t.elDrag),d=l.offset();i.elHandle=t.elHandle,i.elDrag=t.elDrag,i.nX=parseInt(l.css("left"),10)||0,i.nY=parseInt(l.css("top"),10)||0,i.nClientX=d.left+l.width()/2,i.nClientY=d.top+l.height()/2}if(i.bForceDrag&&(o.nX=a.clientX-i.nClientX,o.nY=a.clientY-i.nClientY),t={elArea:this._wel,elFlowOut:i.elDrag.parentNode,elHandle:i.elHandle,elDrag:i.elDrag,weEvent:e,nX:i.nX+o.nX,nY:i.nY+o.nY,nGapX:o.nX,nGapY:o.nY},this.fireEvent("beforeDrag",t)){var g=i.elDrag;if(this.option("bFlowOut")===!1){var f=t.elFlowOut,u=[g.offsetWidth,g.offsetHeight],p=0,_=0;f==document.body&&(p=document.body.scrollLeft||document.documentElement.scrollLeft,_=document.body.scrollTop||document.documentElement.scrollTop,f=null);var c=f&&{w:Math.max(f.offsetWidth,f.scrollWidth),h:Math.max(f.offsetHeight,f.scrollHeight)};if(f&&u[0]<=c.w&&u[1]<=c.h)n={nWidth:f.clientWidth,nHeight:f.clientHeight},p=f.scrollLeft,_=f.scrollTop;else{var v=jindo.$Document().clientSize();n={nWidth:v.width,nHeight:v.height}}null!==t.nX&&(t.nX=Math.max(t.nX,p),t.nX=Math.min(t.nX,n.nWidth-u[0]+p)),null!==t.nY&&(t.nY=Math.max(t.nY,_),t.nY=Math.min(t.nY,n.nHeight-u[1]+_))}null!==t.nX&&(g.style.left=t.nX+"px"),null!==t.nY&&(g.style.top=t.nY+"px"),this.fireEvent("drag",t)}else i.bIsDragging=!1},_onMouseUp:function(e){this._stopDragging(!1);var t=this._htDragInfo;t.bHandleDown=!1,this.fireEvent("handleUp",{weEvent:e,elHandle:t.elHandle,elDrag:t.elDrag})},_onDragStart:function(e){this._findDraggableElement(e.element)&&e.stop(jindo.$Event.CANCEL_DEFAULT)},_onSelectStart:function(e){(this.isDragging()||this._findDraggableElement(e.element))&&e.stop(jindo.$Event.CANCEL_DEFAULT)}}).extend(jindo.UIComponent),jindo.DropArea=jindo.$Class({$init:function(e,t){this._wel=jindo.$(e),this._wel=jindo.$Element(this._wel),this.option({sClassName:"droppable",oDragInstance:null}),this.option(t||{}),this._waOveredDroppableElement=jindo.$A([]),this._elHandle=null,this._elDragging=null,this._wfMouseMove=jindo.$Fn(this._onMouseMove,this),this._wfMouseOver=jindo.$Fn(this._onMouseOver,this),this._wfMouseOut=jindo.$Fn(this._onMouseOut,this);var n=this.option("oDragInstance");if(n){var i=this;n.attach({handleDown:function(e){i._elHandle=e.elHandle,i._waOveredDroppableElement.empty()},dragStart:function(e){i._reCalculate(),i.fireEvent(e.sType,e),i._wfMouseMove.attach(document,"mousemove")},drag:function(e){i._elDragging=e.elDrag},dragEnd:function(e){var t={};for(var n in e)t[n]=e[n];t.aDrop=i.getOveredLists().concat(),i._clearOveredDroppableElement(e.weEvent,e.bInterupted),i.fireEvent(e.sType,t),i._wfMouseMove.detach(document,"mousemove")},handleUp:function(){i._elDragging=null,i._elHandle=null}})}},_addOveredDroppableElement:function(e){-1==this._waOveredDroppableElement.indexOf(e)&&(this._waOveredDroppableElement.push(e),this.fireEvent("over",{elHandle:this._elHandle,elDrag:this._elDragging,elDrop:e}))},_fireMoveEvent:function(e,t,n,i){var a=(n.pageX-t.nLeft)/(t.nRight-t.nLeft),o=(n.pageY-t.nTop)/(t.nBottom-t.nTop);this.fireEvent("move",{weEvent:i,elHandle:this._elHandle,elDrag:this._elDragging,elDrop:e,nRatioX:a,nRatioY:o})},_removeOveredDroppableElement:function(e){var t=this._waOveredDroppableElement.indexOf(e);-1!=t&&(this._waOveredDroppableElement.splice(t,1),this.fireEvent("out",{elHandle:this._elHandle,elDrag:this._elDragging,elDrop:e}))},_clearOveredDroppableElement:function(e,t){if(t)return this._waOveredDroppableElement.empty(),void 0;for(var n;n=this._waOveredDroppableElement.$value()[0];)this._waOveredDroppableElement.splice(0,1),this.fireEvent("drop",{weEvent:e,elHandle:this._elHandle,elDrag:this._elDragging,elDrop:n})},getOveredLists:function(){return this._waOveredDroppableElement?this._waOveredDroppableElement.$value():[]},_isChildOfDropArea:function(e){return this._wel===document||this._wel===e?!0:this._wel.isParentOf(e)},_findDroppableElement:function(e){if(!e)return null;var t="."+this.option("sClassName"),n=jindo.$$.test(e,t)?e:jindo.$$.getSingle("! "+t,e);return this._isChildOfDropArea(e)||(n=null),n},_isDragging:function(){var e=this.option("oDragInstance");return e&&e.isDragging()},_onMouseMove:function(e){if(this._isDragging()){var t=e.pos();if(e.element==this._elDragging||jindo.$Element(this._elDragging).isParentOf(e.element))for(var n,i,a=this._aItem,o=this._aItemRect,r=0;(n=o[r])&&(i=a[r]);r++)n.nLeft<=t.pageX&&t.pageX<=n.nRight&&n.nTop<=t.pageY&&t.pageY<=n.nBottom?(this._addOveredDroppableElement(i),this._fireMoveEvent(i,n,t,e)):this._removeOveredDroppableElement(i);else{var s=this._findDroppableElement(e.element);if(this.elPrevMove&&this.elPrevMove!=s&&(this._removeOveredDroppableElement(this.elPrevMove),this.elPrevMove=null),(s==e.element||!s&&document.elementFromPoint)&&(s=this._findDroppableElement(document.elementFromPoint(t.pageX,t.pageY))),!s)return;this.elPrevMove=s,this._addOveredDroppableElement(s);var h=jindo.$Element(s).offset(),l={nLeft:h.left,nTop:h.top,nRight:h.left+s.offsetWidth,nBottom:h.top+s.offsetHeight};l.nLeft<=t.pageX&&t.pageX<=l.nRight&&l.nTop<=t.pageY&&t.pageY<=l.nBottom&&this._fireMoveEvent(s,l,t,e)}}},_onMouseOver:function(e){if(this._isDragging()){var t=this._findDroppableElement(e.element);t&&this._addOveredDroppableElement(t)}},_onMouseOut:function(e){if(this._isDragging()){var t=this._findDroppableElement(e.element);t&&e.relatedElement&&!jindo.$Element(e.relatedElement).isChildOf(e.element)&&this._removeOveredDroppableElement(t)}},_getRectInfo:function(e){var t=jindo.$Element(e).offset();return{nLeft:t.left,nTop:t.top,nRight:t.left+e.offsetWidth,nBottom:t.top+e.offsetHeight}},_reCalculate:function(){var e=jindo.$$("."+this.option("sClassName"),this._wel);this._wel.tagName&&jindo.$$.test(this._wel,"."+this.option("sClassName"))&&e.push(this._wel),this._aItem=e,this._aItemRect=[];for(var t,n=0;t=e[n];n++)this._aItemRect.push(this._getRectInfo(t))}}).extend(jindo.Component);